<p-dialog 
    [header]="dialogTitle" 
    [(visible)]="visible" 
    [modal]="true" 
    [style]="{width: '600px'}"
    [contentStyle]="{'max-height': '80vh', 'overflow-y': 'auto'}"
    [draggable]="false" 
    [resizable]="false"
    (onHide)="cancel()">
    
    <div class="p-4">
        <form [formGroup]="teamForm" class="space-y-4">
            <!-- Team Name -->
            <div class="field">
                <label for="teamName" class="block mb-2 font-medium text-gray-700 dark:text-gray-300">Team Name</label>
                
                <!-- Name Style Selector -->
                <div class="mb-3">
                    <label for="nameStyle" class="block mb-1 text-sm font-medium text-gray-600 dark:text-gray-400">Name Style</label>
                    <select 
                        id="nameStyle"
                        pInputText
                        class="w-full"
                        [(ngModel)]="teamNameConfig.style"
                        [ngModelOptions]="{ standalone: true }"
                        (change)="onNameStyleChange()">
                        <option *ngFor="let style of availableNameStyles" [value]="style.value">
                            {{ style.label }} - {{ style.description }}
                        </option>
                    </select>
                    <small class="text-gray-500 mt-1 block">
                        Choose a style to generate unique team names. Each style creates different types of names.
                    </small>
                </div>
                
                <div class="flex gap-2">
                    <input 
                        pInputText 
                        id="teamName" 
                        formControlName="name" 
                        class="flex-1"
                        placeholder="Enter team name" />
                    <button 
                        pButton 
                        type="button" 
                        icon="pi pi-refresh" 
                        class="p-button-outlined"
                        (click)="generateRandomTeamName()" 
                        pTooltip="Generate Random Name">
                    </button>
                </div>
            </div>

            <!-- Players Section -->
            <div class="field">
                <label class="block mb-2 font-medium text-gray-700 dark:text-gray-300">
                    Players ({{ getCurrentPlayerCount() }})
                </label>
                
                <!-- Current Players List -->
                <div class="mb-4" *ngIf="getCurrentPlayers().length > 0">
                    <div class="space-y-2">
                        <div *ngFor="let player of getCurrentPlayers(); trackBy: trackByPlayerUid" 
                             class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-medium">
                                    {{ player.display_name?.charAt(0) || '?' }}
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900 dark:text-white">
                                        {{ player.display_name || 'Unknown Player' }}
                                    </div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">
                                        {{ player.email }}
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        Rating: {{ player.rating || 'N/A' }}
                                    </div>
                                </div>
                            </div>
                            <button 
                                pButton 
                                type="button" 
                                icon="pi pi-trash" 
                                class="p-button-danger p-button-text p-button-sm"
                                (click)="removePlayer(player)"
                                pTooltip="Remove Player">
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Add Player Section -->
                <div class="space-y-3">
                    <div class="border-t pt-4">
                        <label class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                            Add Player from Tournament Participants
                        </label>
                        

                        
                        <!-- Player Selection Dropdown -->
                        <p-multiselect 
                            #playerSelect
                            [options]="availablePlayersForSelection"
                            [(ngModel)]="selectedPlayerToAdd" 
                            [ngModelOptions]="{ standalone: true }"
                            optionLabel="display_name" 
                            optionValue="firebase_uid"
                            [placeholder]="isTeamFull() ? 'Team is full (2/2 players)' : 'Select a player to add'" 
                            class="w-full" 
                            [filter]="true" 
                            [showClear]="true"
                            [maxSelectedLabels]="1" 
                            [selectionLimit]="1" 
                            [showToggleAll]="false"
                            [disabled]="isTeamFull()"
                            (onChange)="onPlayerSelected($event, playerSelect)"
                            [appendTo]="'body'">
                        </p-multiselect>
                    </div>
                </div>



                <!-- Info message -->
                <div class="mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700">
                    <i class="pi pi-info-circle mr-1"></i>
                    Only tournament participants can be added to teams. Click the trash icon to remove players.
                </div>
            </div>
        </form>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex gap-2 justify-end">
            <button 
                pButton 
                type="button" 
                label="Cancel" 
                icon="pi pi-times"
                class="p-button-text" 
                (click)="cancel()">
            </button>
            <button 
                pButton 
                type="button" 
                [label]="saveButtonText" 
                icon="pi pi-check" 
                class="p-button-primary"
                [loading]="saving"
                [disabled]="!teamForm.valid || saving"
                (click)="saveTeam()">
            </button>
        </div>
    </ng-template>
</p-dialog>

<!-- Toast Messages -->
<p-toast></p-toast> 